# è¯­éŸ³-è¯­éŸ³ç¿»è¯‘

è¯­éŸ³åˆ°è¯­éŸ³ç¿»è¯‘ï¼ˆSTST æˆ– S2STï¼‰æ˜¯ä¸€é¡¹ç›¸å¯¹è¾ƒæ–°çš„å£è¯­å¤„ç†ä»»åŠ¡ã€‚å®ƒæ¶‰åŠå°†ä¸€ç§è¯­è¨€çš„è¯­éŸ³ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€çš„è¯­éŸ³ï¼š

![s2st](images/s2st.png)

STST å¯è§†ä¸ºä¼ ç»Ÿæœºå™¨ç¿»è¯‘ï¼ˆMTï¼‰ä»»åŠ¡çš„å»¶ä¼¸ï¼šæˆ‘ä»¬ä¸æ˜¯å°†**æ–‡å­—**ä»ä¸€ç§è¯­è¨€ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€ï¼Œè€Œæ˜¯å°†**è¯­éŸ³**ä»ä¸€ç§è¯­è¨€ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€ã€‚STST å¯åº”ç”¨äºå¤šè¯­è¨€äº¤æµé¢†åŸŸï¼Œè®©ä¸åŒè¯­è¨€çš„ä½¿ç”¨è€…é€šè¿‡è¯­éŸ³åª’ä»‹è¿›è¡Œäº¤æµã€‚

å‡è®¾æ‚¨æƒ³è·¨è¶Šè¯­è¨€éšœç¢ä¸ä»–äººäº¤æµã€‚ä½ å¯ä»¥ç›´æ¥è¯´å‡ºæ¥ï¼Œç„¶åè®© STST ç³»ç»Ÿå°†ä½ çš„è¯­éŸ³è½¬æ¢æˆç›®æ ‡è¯­è¨€ï¼Œè€Œä¸æ˜¯å…ˆæŠŠä½ æƒ³ä¼ è¾¾çš„ä¿¡æ¯å†™å‡ºæ¥ï¼Œç„¶åå†ç¿»è¯‘æˆç›®æ ‡è¯­è¨€çš„æ–‡æœ¬ã€‚ç„¶åï¼Œæ”¶ä»¶äººå¯ä»¥é€šè¿‡ STST ç³»ç»Ÿå›è¯ï¼Œè€Œæ‚¨åˆ™å¯ä»¥è†å¬ä»–ä»¬çš„å›åº”ã€‚ä¸åŸºäºæ–‡æœ¬çš„æœºå™¨ç¿»è¯‘ç›¸æ¯”ï¼Œè¿™ç§äº¤æµæ–¹å¼æ›´ä¸ºè‡ªç„¶ã€‚

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ STST çš„*çº§è”*æ–¹æ³•ï¼Œå°†æ‚¨åœ¨è¯¾ç¨‹ç¬¬ 5 å’Œç¬¬ 6 å•å…ƒä¸­å­¦åˆ°çš„çŸ¥è¯†æ‹¼å‡‘åœ¨ä¸€èµ·ã€‚æˆ‘ä»¬å°†ä½¿ç”¨*è¯­éŸ³ç¿»è¯‘ (ST)* ç³»ç»Ÿå°†æºè¯­éŸ³è½¬å½•ä¸ºç›®æ ‡è¯­è¨€æ–‡æœ¬ï¼Œç„¶åä½¿ç”¨æ–‡æœ¬åˆ°è¯­éŸ³ (TTS) ä»ç¿»è¯‘æ–‡æœ¬ç”Ÿæˆç›®æ ‡è¯­è¨€è¯­éŸ³ï¼š

![s2st_cascaded](images/s2st_cascaded.png)

æˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨ä¸‰é˜¶æ®µæ–¹æ³•ï¼Œå³é¦–å…ˆä½¿ç”¨è‡ªåŠ¨è¯­éŸ³è¯†åˆ« (ASR) ç³»ç»Ÿå°†æºè¯­éŸ³è½¬å½•ä¸ºç›¸åŒè¯­è¨€çš„æ–‡æœ¬ï¼Œç„¶åä½¿ç”¨æœºå™¨ç¿»è¯‘å°†è½¬å½•æ–‡æœ¬ç¿»è¯‘ä¸ºç›®æ ‡è¯­è¨€ï¼Œæœ€åä½¿ç”¨æ–‡æœ¬åˆ°è¯­éŸ³æŠ€æœ¯ç”Ÿæˆç›®æ ‡è¯­è¨€çš„è¯­éŸ³ã€‚ç„¶è€Œï¼Œåœ¨æµæ°´çº¿ä¸­æ·»åŠ æ›´å¤šç»„ä»¶ä¼šå¯¼è‡´*é”™è¯¯ä¼ æ’­*ï¼Œå³åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­å¼•å…¥çš„é”™è¯¯åœ¨æµç»å…¶ä½™ç³»ç»Ÿæ—¶ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼ŒåŒæ—¶ä¹Ÿä¼šå¢åŠ å»¶è¿Ÿï¼Œå› ä¸ºéœ€è¦å¯¹æ›´å¤šæ¨¡å‹è¿›è¡Œæ¨ç†ã€‚

è™½ç„¶ STST çš„è¿™ç§çº§è”æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†å´èƒ½äº§ç”Ÿéå¸¸æœ‰æ•ˆçš„ STST ç³»ç»Ÿã€‚ASR + MT + TTS ä¸‰çº§çº§è”ç³»ç»Ÿæ›¾è¢«ç”¨äºæ”¯æŒè®¸å¤šå•†ä¸š STST äº§å“ï¼ŒåŒ…æ‹¬[è°·æ­Œç¿»è¯‘](https://blog.research.google/2019/05/introducing-translatotron-end-to-end.html)ã€‚è¿™ä¹Ÿæ˜¯å¼€å‘ STST ç³»ç»Ÿçš„ä¸€ç§éå¸¸é«˜æ•ˆçš„æ•°æ®å’Œè®¡ç®—æ–¹å¼ï¼Œå› ä¸ºç°æœ‰çš„è¯­éŸ³è¯†åˆ«å’Œæ–‡æœ¬åˆ°è¯­éŸ³ç³»ç»Ÿå¯ä»¥è€¦åˆåœ¨ä¸€èµ·ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ STST æ¨¡å‹ï¼Œè€Œæ— éœ€ä»»ä½•é¢å¤–çš„è®­ç»ƒã€‚

åœ¨æœ¬å•å…ƒçš„å…¶ä½™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†é‡ç‚¹è®¨è®ºå¦‚ä½•åˆ›å»ºä¸€ä¸ª STST ç³»ç»Ÿï¼Œå°†ä»»ä½•è¯­è¨€ X çš„è¯­éŸ³ç¿»è¯‘æˆè‹±è¯­è¯­éŸ³ã€‚æ‰€æ¶‰åŠçš„æ–¹æ³•å¯ä»¥æ‰©å±•åˆ°å°†ä»»ä½•è¯­è¨€ X ç¿»è¯‘æˆä»»ä½•è¯­è¨€ Y çš„ STST ç³»ç»Ÿï¼Œä½†æˆ‘ä»¬å°†æŠŠè¿™ä¸€æ‰©å±•ç•™ç»™è¯»è€…ï¼Œå¹¶åœ¨é€‚ç”¨çš„åœ°æ–¹æä¾›æŒ‡é’ˆã€‚æˆ‘ä»¬å°† STST ä»»åŠ¡è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºä¸¤ä¸ªç»„æˆéƒ¨åˆ†ï¼š ST å’Œ TTSã€‚æœ€åï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä»¬æ‹¼å‡‘åœ¨ä¸€èµ·ï¼Œåˆ¶ä½œä¸€ä¸ª Gradio æ¼”ç¤ºæ¥å±•ç¤ºæˆ‘ä»¬çš„ç³»ç»Ÿã€‚

## è¯­éŸ³ç¿»è¯‘

æˆ‘ä»¬çš„è¯­éŸ³ç¿»è¯‘ç³»ç»Ÿå°†ä½¿ç”¨ Whisper æ¨¡å‹ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿå°†è¶…è¿‡ 96 ç§è¯­è¨€ç¿»è¯‘æˆè‹±è¯­ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°†åŠ è½½ [Whisper Base](https://huggingface.co/openai/whisper-base) æ£€æŸ¥ç‚¹ï¼Œå®ƒçš„å‚æ•°ä¸º 74Mã€‚è¿™ç»ä¸æ˜¯æ€§èƒ½æœ€å¥½çš„ Whisper æ¨¡å‹ï¼Œ[æœ€å¤§çš„ Whisper æ£€æŸ¥ç‚¹](https://huggingface.co/openai/whisper-large-v2)æ¯”å®ƒå¤§ 20 å¤šå€ï¼Œä½†ç”±äºæˆ‘ä»¬è¦å°†ä¸¤ä¸ªè‡ªå›å½’ç³»ç»Ÿï¼ˆST + TTSï¼‰æ•´åˆåœ¨ä¸€èµ·ï¼Œå› æ­¤æˆ‘ä»¬è¦ç¡®ä¿æ¯ä¸ªæ¨¡å‹éƒ½èƒ½ç›¸å¯¹å¿«é€Ÿåœ°ç”Ÿæˆï¼Œä»è€Œè·å¾—åˆç†çš„æ¨ç†é€Ÿåº¦ï¼š

```python
import torch
from transformers import pipeline

device = "cuda:0" if torch.cuda.is_available() else "cpu"
pipe = pipeline(
    "automatic-speech-recognition", model="openai/whisper-base", device=device
)
```

å¤ªå¥½äº†ï¼ä¸ºäº†æµ‹è¯• STST ç³»ç»Ÿï¼Œæˆ‘ä»¬å°†åŠ è½½ä¸€ä¸ªéè‹±è¯­çš„éŸ³é¢‘æ ·æœ¬ã€‚è®©æˆ‘ä»¬åŠ è½½ [VoxPopuli](https://huggingface.co/datasets/facebook/voxpopuli) æ•°æ®é›†æ„å¤§åˆ©è¯­ï¼ˆitï¼‰åˆ†é›†çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼š

```python
from datasets import load_dataset

dataset = load_dataset("facebook/voxpopuli", "it", split="validation", streaming=True)
sample = next(iter(dataset))
```


è¦æ”¶å¬è¿™ä¸ªæ ·æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Hub ä¸Šçš„æ•°æ®é›†æŸ¥çœ‹å™¨æ’­æ”¾ï¼š[facebook/voxpopuli/viewer](https://huggingface.co/datasets/facebook/voxpopuli/viewer/it/validation?row=0)

æˆ–ä½¿ç”¨ ipynb éŸ³é¢‘åŠŸèƒ½æ’­æ”¾ï¼š

```python
from IPython.display import Audio

Audio(sample["audio"]["array"], rate=sample["audio"]["sampling_rate"])
```

ç°åœ¨è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶éŸ³é¢‘è¾“å…¥å¹¶è¿”å›ç¿»è¯‘åçš„æ–‡æœ¬ã€‚ä½ ä¼šè®°å¾—ï¼Œæˆ‘ä»¬å¿…é¡»ä¸º`"task"`ä¼ é€’ç”Ÿæˆå…³é”®å­—å‚æ•°ï¼Œå°†å…¶è®¾ç½®ä¸º`translate`ï¼Œä»¥ç¡®ä¿ Whisper æ‰§è¡Œçš„æ˜¯è¯­éŸ³ç¿»è¯‘è€Œä¸æ˜¯è¯­éŸ³è¯†åˆ«ï¼š

```python
def translate(audio)ï¼š
    outputs = pipe(audio, max_new_tokens=256, generate_kwargs={"task": "translate"})
    return outputs["text"]
```

> åªéœ€åœ¨ç”Ÿæˆå…³é”®å­—å‚æ•°ä¸­å°†ä»»åŠ¡è®¾ç½®ä¸º "transcribe"ï¼Œå¹¶å°† "language"è®¾ç½®ä¸ºç›®æ ‡è¯­è¨€ï¼Œä¾‹å¦‚ï¼Œå¯¹äºè¥¿ç­ç‰™è¯­ï¼Œå¯ä»¥è®¾ç½®ä»¥ä¸‹å‚æ•°ï¼š`generate_kwargs={"task": "transcribe", "language": "es"}`

å¥½æäº†ï¼è®©æˆ‘ä»¬å¿«é€Ÿæ£€æŸ¥ä¸€ä¸‹æ¨¡å‹æ˜¯å¦å¾—å‡ºäº†åˆç†çš„ç»“æœï¼š

```python
translate(sample["audio"].copy())
```

```
' psychological and social. I think that it is a very important step in the construction of a juridical space of freedom, circulation and protection of rights.'
```

å¥½å§ï¼å¦‚æœæˆ‘ä»¬å°†å…¶ä¸åŸæ–‡è¿›è¡Œæ¯”è¾ƒï¼š
```python
sample["raw_text"]
```

```
'Penso che questo sia un passo in avanti importante nella costruzione di uno spazio giuridico di libertÃ  di circolazione e di protezione dei diritti per le persone in Europa.'
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†åœ¨è½¬å½•çš„å¼€å¤´ï¼Œè¯´è¯è€…åœ¨ç»“æŸä¸Šä¸€å¥è¯æ—¶å¤šè¯´äº†å‡ ä¸ªå­—ä¹‹å¤–ï¼Œè¯‘æ–‡å¤§è‡´å»åˆï¼ˆä½ å¯ä»¥ä½¿ç”¨è°·æ­Œç¿»è¯‘è¿›è¡Œå¤æ ¸ï¼‰ã€‚

è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†çº§è” STST ç®¡é“çš„å‰åŠéƒ¨åˆ†ï¼Œå°†ç¬¬äº”å•å…ƒä¸­å­¦ä¹ çš„å¦‚ä½•ä½¿ç”¨ Whisper æ¨¡å‹è¿›è¡Œè¯­éŸ³è¯†åˆ«å’Œç¿»è¯‘çš„æŠ€èƒ½ä»˜è¯¸å®è·µã€‚å¦‚æœä½ æƒ³å¤ä¹ ä¸€ä¸‹æˆ‘ä»¬æ‰€æ¶‰åŠçš„ä»»ä½•æ­¥éª¤ï¼Œè¯·é˜…è¯»ç¬¬äº”å•å…ƒä¸­çš„ [ASR é¢„è®­ç»ƒæ¨¡å‹éƒ¨åˆ†](chapter5/pre-trained_models_for_speech_recognition.md)ã€‚

## æ–‡æœ¬åˆ°è¯­éŸ³
çº§è” STST ç³»ç»Ÿçš„ååŠéƒ¨åˆ†æ¶‰åŠä»è‹±æ–‡æ–‡æœ¬åˆ°è‹±æ–‡è¯­éŸ³çš„æ˜ å°„ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é¢„å…ˆè®­ç»ƒå¥½çš„ [SpeechT5 TTS](https://huggingface.co/microsoft/speecht5_tts) æ¨¡å‹è¿›è¡Œè‹±è¯­ TTSã€‚ğŸ¤— Transformers ç›®å‰æ²¡æœ‰ TTS æµæ°´çº¿ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è‡ªå·±ç›´æ¥ä½¿ç”¨è¯¥æ¨¡å‹ã€‚è¿™æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œä½ ä»¬éƒ½æ˜¯åœ¨ç¬¬ 6 å•å…ƒä¹‹åä½¿ç”¨è¯¥æ¨¡å‹è¿›è¡Œæ¨ç†çš„ä¸“å®¶ï¼

é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»é¢„è®­ç»ƒæ£€æŸ¥ç‚¹åŠ è½½ SpeechT5 å¤„ç†å™¨ã€æ¨¡å‹å’Œå£°ç å™¨ï¼š

```python
from transformers import SpeechT5Processor, SpeechT5ForTextToSpeech, SpeechT5HifiGan

processor = SpeechT5Processor.from_pretrained("microsoft/speecht5_tts")

model = SpeechT5ForTextToSpeech.from_pretrained("microsoft/speecht5_tts")
vocoder = SpeechT5HifiGan.from_pretrained("microsoft/speecht5_hifigan")
```

> è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸“é—¨ä¸ºè‹±è¯­ TTS è®­ç»ƒçš„ SpeechT5 æ£€æŸ¥ç‚¹ã€‚å¦‚æœæ‚¨æƒ³ç¿»è¯‘æˆè‹±è¯­ä»¥å¤–çš„å…¶ä»–è¯­è¨€ï¼Œå¯ä»¥å°†æ£€æŸ¥ç‚¹æ¢æˆæ ¹æ®æ‚¨é€‰æ‹©çš„è¯­è¨€å¾®è°ƒè¿‡çš„ SpeechT5 TTS æ¨¡å‹ï¼Œæˆ–è€…ä½¿ç”¨æ ¹æ®æ‚¨çš„ç›®æ ‡è¯­è¨€é¢„å…ˆè®­ç»ƒè¿‡çš„ MMS TTS æ£€æŸ¥ç‚¹ã€‚

ä¸ Whisper æ¨¡å‹ä¸€æ ·ï¼Œå¦‚æœæœ‰ GPU åŠ é€Ÿè®¾å¤‡ï¼Œæˆ‘ä»¬å°†æŠŠ SpeechT5 æ¨¡å‹å’Œå£°ç å™¨æ”¾åœ¨ GPU åŠ é€Ÿè®¾å¤‡ä¸Šï¼š

```python
model.to(device)
vocoder.to(device)
```

å¤ªå¥½äº†ï¼Œè®©æˆ‘ä»¬åŠ è½½è¯´è¯äººembeddingsï¼š

```python
embeddings_dataset = load_dataset("Matthijs/cmu-arctic-xvectors", split="validation")
speaker_embeddings = torch.tensor(embeddings_dataset[7306]["xvector"]).unsqueeze(0)
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå°†æ–‡æœ¬æç¤ºä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„è¯­éŸ³ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ SpeechT5 å¤„ç†å™¨å¯¹æ–‡æœ¬è¾“å…¥è¿›è¡Œé¢„å¤„ç†ï¼Œæ ‡è®°æ–‡æœ¬ä»¥è·å¾—è¾“å…¥ idã€‚ç„¶åï¼Œæˆ‘ä»¬ä¼šå°†è¾“å…¥ id å’Œè¯´è¯äººåµŒå…¥ä¿¡æ¯ä¼ é€’ç»™ SpeechT5 æ¨¡å‹ï¼Œå¦‚æœæœ‰åŠ é€Ÿè®¾å¤‡ï¼Œåˆ™å°†å…¶æ”¾ç½®åœ¨åŠ é€Ÿè®¾å¤‡ä¸Šã€‚æœ€åï¼Œæˆ‘ä»¬å°†è¿”å›ç”Ÿæˆçš„è¯­éŸ³ï¼Œå°†å…¶å¸¦å› CPUï¼Œä»¥ä¾¿åœ¨æˆ‘ä»¬çš„ ipynb ç¬”è®°æœ¬ä¸­æ’­æ”¾ï¼š

```python
def synthesise(text):
    inputs = processor(text=text, return_tensors="pt")
    speech = model.generate_speech(
        inputs["input_ids"].to(device), speaker_embeddings.to(device), vocoder=vocoder
    )
    return speech.cpu()
```

è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªè™šæ‹Ÿæ–‡æœ¬è¾“å…¥æ¥æ£€æŸ¥å®ƒæ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```python
speech = synthesise("Hey there! This is a test!")

Audio(speech, rate=16000)
```

å¬èµ·æ¥ä¸é”™ï¼ç°åœ¨æ˜¯æ¿€åŠ¨äººå¿ƒçš„éƒ¨åˆ†--æ‹¼å‡‘è¿™ä¸€åˆ‡ã€‚

## åˆ›å»º STST æ¼”ç¤º

åœ¨åˆ›å»º Gradio æ¼”ç¤ºæ¥å±•ç¤º STST ç³»ç»Ÿä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆåšä¸€ä¸ªå¿«é€Ÿå¥å…¨æ€§æ£€æŸ¥ï¼Œç¡®ä¿æˆ‘ä»¬å¯ä»¥ä¸²è”ä¸¤ä¸ªæ¨¡å‹ï¼Œå³è¾“å…¥éŸ³é¢‘æ ·æœ¬å’Œè¾“å‡ºéŸ³é¢‘æ ·æœ¬ã€‚æˆ‘ä»¬å°†é€šè¿‡ä¸²è”å‰ä¸¤ä¸ªå°èŠ‚ä¸­å®šä¹‰çš„ä¸¤ä¸ªå‡½æ•°æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå³è¾“å…¥æºéŸ³é¢‘å¹¶æ£€ç´¢ç¿»è¯‘æ–‡æœ¬ï¼Œç„¶ååˆæˆç¿»è¯‘æ–‡æœ¬ä»¥è·å¾—ç¿»è¯‘è¯­éŸ³ã€‚æœ€åï¼Œæˆ‘ä»¬å°†åˆæˆè¯­éŸ³è½¬æ¢ä¸º `int16` æ•°ç»„ï¼Œè¿™æ˜¯ Gradio æœŸæœ›çš„è¾“å‡ºéŸ³é¢‘æ–‡ä»¶æ ¼å¼ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ ¹æ®ç›®æ ‡ dtypeï¼ˆ`int16`ï¼‰çš„åŠ¨æ€èŒƒå›´å¯¹éŸ³é¢‘æ•°ç»„è¿›è¡Œå½’ä¸€åŒ–ï¼Œç„¶åå°† NumPy çš„é»˜è®¤ dtypeï¼ˆ`float64`ï¼‰è½¬æ¢ä¸ºç›®æ ‡ dtypeï¼ˆ`int16`ï¼‰ï¼š

```python
import numpy as np

target_dtype = np.int16
max_range = np.iinfo(target_dtype).max


def speech_to_speech_translation(audio):
    translated_text = translate(audio)
    synthesised_speech = synthesise(translated_text)
    synthesised_speech = (synthesised_speech.numpy() * max_range).astype(np.int16)
    return 16000, synthesised_speech
```

è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªè¿æ¥å‡½æ•°æ˜¯å¦èƒ½å¾—åˆ°é¢„æœŸçš„ç»“æœï¼š

```python
sampling_rate, synthesised_speech = speech_to_speech_translation(sample["audio"])

Audio(synthesised_speech, rate=sampling_rate)
```

å®Œç¾ï¼ç°åœ¨ï¼Œæˆ‘ä»¬å°†æŠŠè¿™ä¸€åˆ‡æ‰“åŒ…æˆä¸€ä¸ªæ¼‚äº®çš„ Gradio æ¼”ç¤ºï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨éº¦å…‹é£è¾“å…¥æˆ–æ–‡ä»¶è¾“å…¥å½•åˆ¶æºè¯­éŸ³ï¼Œå¹¶å›æ”¾ç³»ç»Ÿçš„é¢„æµ‹ç»“æœï¼š

```python
import gradio as gr

demo = gr.Blocks()

mic_translate = gr.Interface(
    fn=speech_to_speech_translation,
    inputs=gr.Audio(source="microphone", type="filepath"),
    outputs=gr.Audio(label="Generated Speech", type="numpy"),
)

file_translate = gr.Interface(
    fn=speech_to_speech_translation,
    inputs=gr.Audio(source="upload", type="filepath"),
    outputs=gr.Audio(label="Generated Speech", type="numpy"),
)

with demo:
    gr.TabbedInterface([mic_translate, file_translate], ["Microphone", "Audio File"])

demo.launch(debug=True)
```

è¿™å°†å¯åŠ¨ä¸€ä¸ª Gradio æ¼”ç¤ºï¼Œä¸åœ¨ Hugging Face Hub ä¸Šè¿è¡Œçš„æ¼”ç¤ºç±»ä¼¼ï¼š

æ‚¨å¯ä»¥[å¤åˆ¶](https://huggingface.co/spaces/course-demos/speech-to-speech-translation?duplicate=true)è¿™ä¸ªæ¼”ç¤ºï¼Œå¹¶å°†å…¶è°ƒæ•´ä¸ºä½¿ç”¨ä¸åŒçš„ Whisper æ£€æŸ¥ç‚¹ã€ä¸åŒçš„ TTS æ£€æŸ¥ç‚¹ï¼Œæˆ–è€…æ”¾å®½è¾“å‡ºè‹±è¯­è¯­éŸ³çš„é™åˆ¶ï¼Œå¹¶æŒ‰ç…§æä¾›çš„æç¤ºç¿»è¯‘æˆæ‚¨é€‰æ‹©çš„è¯­è¨€ï¼

## ç»§ç»­å‰è¿›

è™½ç„¶çº§è”ç³»ç»Ÿæ˜¯æ„å»º STST ç³»ç»Ÿçš„ä¸€ç§è®¡ç®—å’Œæ•°æ®é«˜æ•ˆæ–¹æ³•ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä¸Šè¿°é”™è¯¯ä¼ æ’­å’Œå»¶è¿Ÿå¢åŠ çš„é—®é¢˜ã€‚è¿‘æœŸçš„ç ”ç©¶æ¢ç´¢äº† STST çš„*ç›´æ¥*æ–¹æ³•ï¼Œå³ä¸é¢„æµ‹ä¸­é—´æ–‡æœ¬è¾“å‡ºï¼Œè€Œæ˜¯ç›´æ¥ä»æºè¯­éŸ³æ˜ å°„åˆ°ç›®æ ‡è¯­éŸ³ã€‚è¿™äº›ç³»ç»Ÿè¿˜èƒ½åœ¨ç›®æ ‡è¯­éŸ³ä¸­ä¿ç•™æºè¯´è¯è€…çš„è¯´è¯ç‰¹ç‚¹ï¼ˆå¦‚å‰å¥ã€éŸ³é«˜å’Œè¯­è°ƒï¼‰ã€‚å¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æœ‰å…³è¿™äº›ç³»ç»Ÿçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[è¡¥å……é˜…è¯»](chapter7/supplemental_reading_and_resources.md)éƒ¨åˆ†åˆ—å‡ºçš„èµ„æºã€‚